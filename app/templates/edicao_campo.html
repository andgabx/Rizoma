<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Campo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
</head>
<body class="bg-white min-h-screen">
    <div class="max-w-md mx-auto p-4">

        <header class="flex items-center justify-around mb-8">
            <a href="{% url 'detalhes-campo' campo.id %}" id="back-button" class="p-2">
                <i class="bi bi-arrow-left text-2xl"></i>
            </a>
            <h1 class="text-xl font-bold flex-1 text-right mr-2">Editar campo</h1>
        </header>

        {% include 'components/component_modal.html' with message="Campo editado com sucesso!" link="campos" %}

  
        <form id="edit-form" action="{% url 'edicao_campo' campo.id %}" method="post" data-redirect-url="{% url 'detalhes-campo' campo.id %}" class="space-y-6">
            {% csrf_token %}
    
            <div class="space-y-2">
                <label class="block font-medium">Nomear campo</label>
                <input 
                    id="nome-campo"
                    name="nome"
                    type="text" 
                    placeholder="Nome do campo"
                    value="{{ campo.nome }}"
                    class="w-full p-3 bg-gray-200 rounded-lg"
                >
            </div>

            <div class="space-y-2">
                <label class="block font-medium">Adicionar descrição (opcional)</label>
                <textarea 
                    name="descricao"
                    placeholder="Descrição"
                    class="w-full p-3 bg-gray-200 rounded-lg resize-none h-24"
                >{{ campo.descricao }}</textarea>
            </div>

            <div class="bg-gray-300 h-48 rounded-lg flex items-center justify-center">
                <i class="bi bi-card-image text-4xl text-gray-600"></i>
            </div>

            <div class="relative">
                <select name="tipo_campo" class="w-full p-3 bg-gray-200 rounded-lg appearance-none pr-10">
                    <option value="" disabled selected>Tipo de campo</option>
                    <option value="1" {% if campo.tipo == "1" %}selected{% endif %}>Horta</option>
                    <option value="2" {% if campo.tipo == "2" %}selected{% endif %}>Jardim</option>
                    <option value="3" {% if campo.tipo == "3" %}selected{% endif %}>Pomar</option>
                </select>
                <i class="bi bi-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-gray-500"></i>
            </div>

            <div class="relative">
                <select name="tipo_solo" class="w-full p-3 bg-gray-200 rounded-lg appearance-none pr-10">
                    <option value="" disabled selected>Tipo de solo</option>
                    <option value="1" {% if campo.tipo_solo == "1" %}selected{% endif %}>Arenoso</option>
                    <option value="2" {% if campo.tipo_solo == "2" %}selected{% endif %}>Argiloso</option>
                    <option value="3" {% if campo.tipo_solo == "3" %}selected{% endif %}>Humoso</option>
                </select>
                <i class="bi bi-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-gray-500"></i>
            </div>

   
            <button 
                id="submit-button"
                type="button" 
                class="w-full p-3 bg-gray-300 rounded-lg font-medium"
            >
                Concluir
            </button>
        </form>
    </div>


    


    <script>
        const submitButton = document.getElementById("submit-button");
        const editForm = document.getElementById("edit-form");
        const modalContainer = document.getElementById("popup-container");
        const modalContent = document.getElementById("popup-modal");
        const confirmButton = document.getElementById("confirm-button");

        submitButton.addEventListener("click", (event) => {
            event.preventDefault();
            const formData = new FormData(editForm);

            fetch(editForm.action, {
                method: "POST",
                body: formData,
                headers: {
                    "X-Requested-With": "XMLHttpRequest",
                },
            })
            .then((response) => {
                if (response.ok) {
                    // Show the modal
                    showModal();

                    // Optionally, animate the modal with Anime.js
                    anime({
                        targets: modalContent,
                        scale: [0.8, 1],
                        opacity: [0, 1],
                        duration: 500,
                        easing: "easeOutExpo",
                    });
                } else {
                    alert("Erro ao editar o campo.");
                }
            })
            .catch((error) => {
                console.error("Erro ao enviar o formulário:", error);
            });
        });

        confirmButton.addEventListener("click", () => {
            modalContainer.classList.remove("hidden");
            // Optional: Redirect after confirmation
            // window.location.href = editForm.dataset.redirectUrl;
        });

    </script>


</body>
</html>
